vcpkg repro

vcpkg install iccdev

UNIX Repro

Ports File

# portfile.cmake

vcpkg_from_github(
    OUT_SOURCE_PATH SOURCE_PATH
    REPO InternationalColorConsortium/iccDEV
    REF 5bda6e17d27f383a46ce5b090cca8ccc32250601
)

# Make libxml2/iconv headers visible
list(APPEND CMAKE_INCLUDE_PATH "${CURRENT_INSTALLED_DIR}/include")

# Common options for one configure
set(_COMMON_OPTS
    -DENABLE_TESTS=OFF
    -DENABLE_INSTALL_RIM=ON
    -DENABLE_ICCXML=ON
    -DENABLE_SHARED_LIBS=ON
    -DENABLE_STATIC_LIBS=ON
    -DENABLE_TOOLS=ON
    -DCMAKE_DEBUG_POSTFIX=
    # Hint paths if upstream does any find_library fallback
    "-DCMAKE_PREFIX_PATH=${CURRENT_PACKAGES_DIR};${CURRENT_INSTALLED_DIR}"
    "-DCMAKE_LIBRARY_PATH=${CURRENT_PACKAGES_DIR}/lib;${CURRENT_PACKAGES_DIR}/debug/lib"
    "-DCMAKE_INCLUDE_PATH=${CURRENT_INSTALLED_DIR}/include"
    # CRITICAL: tell IccXML to link the *target*, not a raw .lib path
    -DTARGET_LIB_ICCPROFLIB=IccProfLib2
)

# DO NOT override MSVC runtime; keep vcpkg defaults (/MD, /MDd)

vcpkg_cmake_configure(
    SOURCE_PATH "${SOURCE_PATH}/Build/Cmake"
    OPTIONS ${_COMMON_OPTS}
)

# --- Stage 1:
# If upstream ever renames these, swap the target names accordingly.
vcpkg_cmake_build(TARGET IccProfLib2)   # core color lib
vcpkg_cmake_build(TARGET IccXML2)       # XML lib depends on the core lib
vcpkg_cmake_install()

# --- Stage 2: 
vcpkg_cmake_build(TARGET iccApplyToLink)
vcpkg_cmake_build(TARGET iccDumpProfile)
vcpkg_cmake_build(TARGET iccFromCube)
vcpkg_cmake_build(TARGET iccFromXml)
vcpkg_cmake_build(TARGET iccRoundTrip)
vcpkg_cmake_build(TARGET iccToXml)
vcpkg_cmake_build(TARGET iccV5DspObsToV4Dsp)
vcpkg_cmake_install()

# Stage CLI tools under tools/<port>
vcpkg_copy_tools(
    TOOL_NAMES
        iccApplyToLink
        iccDumpProfile
        iccFromCube
        iccFromXml
        iccRoundTrip
        iccToXml
        iccV5DspObsToV4Dsp
    AUTO_CLEAN
)

# Fix CMake package layout if upstream uses a custom subdir
vcpkg_cmake_config_fixup(CONFIG_PATH lib/cmake/reficcmax)

# Housekeeping
file(REMOVE_RECURSE "${CURRENT_PACKAGES_DIR}/debug/include")
vcpkg_install_copyright(FILE_LIST "${SOURCE_PATH}/LICENSE.md")

# Policies actually needed
set(VCPKG_POLICY_SKIP_ABSOLUTE_PATHS_CHECK enabled)
set(VCPKG_POLICY_SKIP_MISPLACED_CMAKE_FILES_CHECK enabled)
set(VCPKG_POLICY_DLLS_WITHOUT_EXPORTS enabled)




xss@xss:~/tmp/DemoIccMAX$ vcpkg/vcpkg install iccdev --overlay-ports=ports    --clean-after-build --no-binarycaching



Computing installation plan...
The following packages will be built and installed:
    iccdev:x64-linux@2.2.50 -- /home/xss/tmp/DemoIccMAX/ports/iccdev
Detecting compiler hash for triplet x64-linux...
Compiler found: /usr/bin/c++
Installing 1/1 iccdev:x64-linux@2.2.50...
Building iccdev:x64-linux@2.2.50...
/home/xss/tmp/DemoIccMAX/ports/iccdev: info: installing overlay port from here
Downloading https://github.com/InternationalColorConsortium/iccDEV/archive/5bda6e17d27f383a46ce5b090cca8ccc32250601.tar.gz -> InternationalColorConsortium-iccDEV-5bda6e17d27f383a46ce5b090cca8ccc32250601.tar.gz
Successfully downloaded InternationalColorConsortium-iccDEV-5bda6e17d27f383a46ce5b090cca8ccc32250601.tar.gz
-- Extracting source /home/xss/tmp/DemoIccMAX/vcpkg/downloads/InternationalColorConsortium-iccDEV-5bda6e17d27f383a46ce5b090cca8ccc32250601.tar.gz
-- Using source at /home/xss/tmp/DemoIccMAX/vcpkg/buildtrees/iccdev/src/cc32250601-a2d73cb662.clean
-- Configuring x64-linux
-- Building x64-linux-dbg
-- Building x64-linux-rel
-- Building x64-linux-dbg
-- Building x64-linux-rel
-- Building x64-linux-dbg
-- Building x64-linux-rel
-- Building x64-linux-dbg
-- Building x64-linux-rel
-- Building x64-linux-dbg
-- Building x64-linux-rel
-- Building x64-linux-dbg
-- Building x64-linux-rel
-- Building x64-linux-dbg
-- Building x64-linux-rel
-- Building x64-linux-dbg
-- Building x64-linux-rel
-- Building x64-linux-dbg
-- Building x64-linux-rel
-- Building x64-linux-dbg
-- Building x64-linux-rel
-- Building x64-linux-dbg
-- Building x64-linux-rel
-- Installing: /home/xss/tmp/DemoIccMAX/vcpkg/packages/iccdev_x64-linux/share/iccdev/copyright
-- Adjusted RPATH of '/home/xss/tmp/DemoIccMAX/vcpkg/packages/iccdev_x64-linux/debug/lib/libIccProfLib2.so.2.3.1' (From '' -> To '$ORIGIN')
-- Adjusted RPATH of '/home/xss/tmp/DemoIccMAX/vcpkg/packages/iccdev_x64-linux/debug/lib/libIccXML2.so.2.3.1' (From '' -> To '$ORIGIN')
-- Adjusted RPATH of '/home/xss/tmp/DemoIccMAX/vcpkg/packages/iccdev_x64-linux/lib/libIccProfLib2.so.2.3.1' (From '' -> To '$ORIGIN')
-- Adjusted RPATH of '/home/xss/tmp/DemoIccMAX/vcpkg/packages/iccdev_x64-linux/lib/libIccXML2.so.2.3.1' (From '' -> To '$ORIGIN')
-- Adjusted RPATH of '/home/xss/tmp/DemoIccMAX/vcpkg/packages/iccdev_x64-linux/tools/iccdev/iccApplyToLink' (From '' -> To '$ORIGIN:$ORIGIN/../../lib')
-- Adjusted RPATH of '/home/xss/tmp/DemoIccMAX/vcpkg/packages/iccdev_x64-linux/tools/iccdev/iccDumpProfile' (From '' -> To '$ORIGIN:$ORIGIN/../../lib')
-- Adjusted RPATH of '/home/xss/tmp/DemoIccMAX/vcpkg/packages/iccdev_x64-linux/tools/iccdev/iccFromCube' (From '' -> To '$ORIGIN:$ORIGIN/../../lib')
-- Adjusted RPATH of '/home/xss/tmp/DemoIccMAX/vcpkg/packages/iccdev_x64-linux/tools/iccdev/iccFromXml' (From '' -> To '$ORIGIN:$ORIGIN/../../lib')
-- Adjusted RPATH of '/home/xss/tmp/DemoIccMAX/vcpkg/packages/iccdev_x64-linux/tools/iccdev/iccRoundTrip' (From '' -> To '$ORIGIN:$ORIGIN/../../lib')
-- Adjusted RPATH of '/home/xss/tmp/DemoIccMAX/vcpkg/packages/iccdev_x64-linux/tools/iccdev/iccToXml' (From '' -> To '$ORIGIN:$ORIGIN/../../lib')
-- Adjusted RPATH of '/home/xss/tmp/DemoIccMAX/vcpkg/packages/iccdev_x64-linux/tools/iccdev/iccV5DspObsToV4Dsp' (From '' -> To '$ORIGIN:$ORIGIN/../../lib')
-- Performing post-build validation
Elapsed time to handle iccdev:x64-linux: 31 s
iccdev:x64-linux package ABI: 53300ea2f787a78e90bcb7efb24965588fb83e4eee245848c60d12832db4606b
Total install time: 31 s
Installed contents are licensed to you by owners. Microsoft is not responsible for, nor does it grant any licenses to, third-party packages.
Packages installed in this vcpkg installation declare the following licenses:
MIT
All requested installations completed successfully in: 31 s